datasource db {
  provider = "sqlite"
  // provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name     String @default("")
  email    String @unique
  password String
  access   String

  Atleta      Atleta[]
  Equipa      Equipa[]
  Notificacao Notificacao[]
  Clube       Clube[]
  permissoes  permissoes[]

  @@map("users")
}

model Atleta {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  nascimento DateTime
  posicao    String
  publico    Boolean  @default(false)
  foto       String?

  equipe   Equipa @relation(fields: [equipaId], references: [id])
  equipaId Int

  user   User @relation(fields: [userId], references: [id])
  userId Int  @unique

  HistoricoAtleta HistoricoAtleta[]
  Destaque        Destaque[]
  Videos          Videos[]
}

model Clube {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name        String
  ano         Int
  telefone    String
  email       String
  modalidade  String
  dirigente   User   @relation(fields: [dirigenteId], references: [id])
  dirigenteId Int

  province    Provincia @relation(fields: [provinciaId], references: [id])
  provinciaId Int
  Equipa      Equipa[]
}

model Equipa {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  categoria String
  escalao   String
  nome      String

  treinador   User @relation(fields: [treinadorId], references: [id])
  treinadorId Int

  clube   Clube @relation(fields: [clubeId], references: [id])
  clubeId Int

  Treino Treino[]
  Atleta Atleta[]

  // Relações com Jogo
  JogoEquipa     Jogo[] @relation("JogoEquipa")
  JogoAdversario Jogo[] @relation("JogoAdversario")
}

model Provincia {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name  String
  Clube Clube[]
}

model Movimentos {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  valor     Decimal
  descricao String
  tipo      String // Entrada ou Saída
  data      DateTime
}

model Treino {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  descricao  String
  data       DateTime
  duracaoMin Int
  local      String

  equipa   Equipa @relation(fields: [equipaId], references: [id])
  equipaId Int
}

model Notificacao {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  titulo   String
  mensagem String
  lida     Boolean @default(false)

  user User @relation(fields: [userId], references: [id])

  userId Int
}

model Jogo {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  descricao String
  data      DateTime
  local     String

  // Relação com a equipa "adversário"
  adversario   Equipa @relation("JogoAdversario", fields: [adversarioId], references: [id])
  adversarioId Int

  tipo String

  // Relação com a equipa "propria"
  equipa   Equipa @relation("JogoEquipa", fields: [equipaId], references: [id])
  equipaId Int

  HistoricoAtleta HistoricoAtleta[]
}

model HistoricoAtleta {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  minutos       Int?
  gols          Int?
  assistencias  Int?
  faltas        Int?
  avaliacaoStar Int?

  jogo   Jogo @relation(fields: [jogoId], references: [id])
  jogoId Int

  atleta   Atleta @relation(fields: [atletaId], references: [id])
  atletaId Int
}

model Destaque {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  titulo    String
  descricao String?
  data      DateTime @default(now())
  foto      String?

  atleta   Atleta @relation(fields: [atletaId], references: [id])
  atletaId Int

  aprovado Boolean
}

model Videos {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  titulo    String
  descricao String?
  url       String
  data      DateTime

  atletaId Int
  atleta   Atleta @relation(fields: [atletaId], references: [id])

  aprovado Boolean
}

// De acordo o nível de accesso têm um bloco de permissões
model permissoes {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user      User   @relation(fields: [userId], references: [id])
  permissao String
  userId    Int
}
